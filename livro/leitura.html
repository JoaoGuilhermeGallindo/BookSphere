<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leitura Online</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
    <link rel="shortcut icon" href="../LOGOS/Favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        :root{--primary-bg:#eee;--text-color:#000;--menu-bg:#2d72bc;--menu-text:#fff;--page-border:#000;--button-color:#000;--modal-bg:#fff;--modal-text:#000;--modal-textarea-bg:#f3f4f6;--modal-textarea-border:#d1d5db;--panel-bg:#fff;--panel-border:#e5e7eb;--item-border:#e5e7eb;--item-hover-bg:#f9fafb;--page-indicator-bg:rgba(0,0,0,0.6);--page-indicator-text:#fff}
        body{background-color:var(--primary-bg);color:var(--text-color);height:100vh;margin:0;font-family:sans-serif;transition:background-color .3s,color .3s;overflow:hidden}
        body.modo-noturno{--primary-bg:#121212;--text-color:#e2e8f0;--page-border:#4a4a4a;--button-color:#e2e8f0;--modal-bg:#2a2a2a;--modal-text:#e2e8f0;--modal-textarea-bg:#1e1e1e;--modal-textarea-border:#4a4a4a;--panel-bg:#1f2937;--panel-border:#374151;--item-border:#374151;--item-hover-bg:#374151;--page-indicator-bg:rgba(255,255,255,0.1);--page-indicator-text:#e2e8f0}
        body.modo-noturno .flipbook-container canvas{filter:invert(.9) hue-rotate(180deg)}
        body.modo-sepia{--primary-bg:#fbf0d9;--text-color:#5b4636;--page-border:#dcd0b9;--button-color:#5b4636;--modal-bg:#efe2cd;--modal-text:#5b4636;--modal-textarea-bg:#f5eada;--modal-textarea-border:#dcd0b9;--panel-bg:#f5eada;--panel-border:#dcd0b9;--item-border:#dcd0b9;--item-hover-bg:#efe2cd;--page-indicator-bg:rgba(91,70,54,0.6);--page-indicator-text:#f5eada}
        body.modo-sepia .flipbook-container canvas{filter:sepia(.9)}

        /* CORREÇÃO ESTRUTURAL: Layout Desktop (Default) */
        body { display: flex; }
        nav.menu-lateral {
            width: 60px;
            height: 100%;
            background-color: var(--menu-bg);
            padding: 5px 0 40px 1%;
            transition: width .3s ease;
            z-index: 1000;
            flex-shrink: 0; /* Impede que o menu encolha */
        }
        nav.menu-lateral.expandir { width: 300px; }
        #main-content {
            width: 100%; /* Ocupa o resto do espaço */
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-expandir{width:100%;padding-left:10px}
        .btn-expandir #btn-exp{color:var(--menu-text);font-size:30px;cursor:pointer}
        ul{height:100%;list-style-type:none;padding:0;margin-top:20px;display:flex;flex-direction:column}
        ul li.item-menu{flex-grow:1;display:flex;align-items:center}
        ul li.item-menu .itens{color:var(--menu-text);text-decoration:none;font-size:20px;padding:10px;display:flex;align-items:center;line-height:40px;cursor:pointer;border-radius:8px;width:100%}
        ul li.item-menu .itens:hover{background-color:rgba(255,255,255,0.1)}
        ul li.item-menu .itens .txt-link{margin-left:0;overflow:hidden;white-space:nowrap;transition:opacity .3s,margin-left .3s;opacity:0}
        nav.menu-lateral.expandir .itens .txt-link{margin-left:20px;opacity:1}
        ul li.item-menu .itens .icon > i{font-size:30px}

        /* FLIPBOOK E NAVEGAÇÃO */
        .flipbook-container{display:flex;justify-content:center;align-items:flex-start;gap:0}
        .page-container{position:relative}
        .page-wrapper{position:relative;display:inline-block;border:2px solid var(--page-border);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
        .page-wrapper canvas{display:block;z-index:1}
        .button-left,.button-right{background:none;border:none;padding:0;cursor:pointer;font-size:34px;color:var(--button-color);z-index:50;align-self:center;transition:all .3s ease}
        .button-left{margin-right:12px}
        .button-right{margin-left:12px}
        ::selection{background:rgba(96,165,250,0.3)}
        #page-indicator{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);background-color:var(--page-indicator-bg);color:var(--page-indicator-text);padding:8px 16px;border-radius:20px;font-size:14px;z-index:100;pointer-events:none;box-shadow:0 2px 5px rgba(0,0,0,0.2)}

        /* BOOKMARK */
        .bookmark-icon{position:absolute;top:-2px;font-size:48px;color:rgba(255,255,255,0.7);text-shadow:0 0 5px rgba(0,0,0,0.5);z-index:20;cursor:pointer;opacity:0;transition:opacity .2s ease-in-out,color .2s ease-in-out;pointer-events:none}
        .page-container:hover .bookmark-icon{opacity:1;pointer-events:all}
        .bookmark-icon.bookmarked{opacity:1;color:#d9534f;text-shadow:none}
        .bookmark-icon.animate-pop{animation:pop-animation .3s ease-in-out}
        @keyframes pop-animation{0%{transform:scale(1)}50%{transform:scale(1.4)}100%{transform:scale(1)}}
        .bookmark-icon.left{left:-2px;transform-origin:top left}
        .bookmark-icon.right{right:-2px;transform-origin:top right}

        /* MODAIS E PAINEL (Compactados) */
        .modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.6);align-items:center;justify-content:center}.modal-content{background:var(--modal-bg);color:var(--modal-text);padding:20px;width:90%;max-width:400px;border-radius:8px;position:relative}.text-center{text-align:center}.modal-title{font-size:1.25rem;font-weight:bold;margin-bottom:1rem}.modal-text{margin-bottom:1.5rem}.modal-textarea{width:100%;height:100px;border:1px solid var(--modal-textarea-border);border-radius:4px;padding:8px;background-color:var(--modal-textarea-bg);color:var(--modal-text);box-sizing:border-box}.modal-actions{margin-top:1rem;text-align:right}.modal-actions.space-between{display:flex;justify-content:space-between;gap:8px}.modal-actions.flex-col{flex-direction:column;gap:10px}.modal-btn-primary,.modal-btn-secondary,.modal-btn-red,.modal-btn-yellow{padding:8px 16px;border:none;border-radius:4px;cursor:pointer;font-weight:bold;flex-grow:1}.modal-btn-primary{background-color:#3b82f6;color:white}.modal-btn-primary:hover{background-color:#2563eb}.modal-btn-secondary{background-color:#d1d5db;color:#1f2937}.modal-btn-secondary:hover{background-color:#9ca3af}.modal-btn-red{background-color:#ef4444;color:white}.modal-btn-red:hover{background-color:#dc2626}.modal-btn-yellow{background-color:#f59e0b;color:white}.modal-btn-yellow:hover{background-color:#d97706}.close-modal-btn{position:absolute;top:10px;right:10px;background:none;border:none;font-size:24px;cursor:pointer;color:var(--modal-text)}.modal-note-text{margin:8px 0;padding:8px;white-space:pre-wrap;word-break:break-word}
        .annotations-panel-class{position:fixed;top:0;right:0;height:100%;width:384px;max-width:90%;background-color:var(--panel-bg);box-shadow:-2px 0 8px rgba(0,0,0,0.1);border-left:1px solid var(--panel-border);z-index:900;transform:translateX(100%);transition:transform .3s ease-in-out;display:flex;flex-direction:column}.annotations-panel-class.open{transform:translateX(0)}.annotations-panel-header{display:flex;flex-direction:column;padding:1rem;border-bottom:1px solid var(--panel-border)}.header-top-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem}.annotations-panel-title{font-size:1.25rem;font-weight:bold}#annotation-search-input{width:100%;padding:8px;border-radius:4px;border:1px solid var(--modal-textarea-border);background-color:var(--modal-textarea-bg);color:var(--modal-text)}.close-annotations-btn-class{background:none;border:none;font-size:20px;cursor:pointer;padding:8px;border-radius:50%}.close-annotations-btn-class:hover{background-color:rgba(0,0,0,0.1)}.annotations-list-class{overflow-y:auto;flex-grow:1}.annotation-item{padding:16px;border-bottom:1px solid var(--item-border);cursor:pointer;transition:background-color .2s}.annotation-item:hover{background-color:var(--item-hover-bg)}.annotation-item .text-xs{font-size:.75rem;color:#6b7280;display:flex;justify-content:space-between;margin-bottom:8px}body.modo-noturno .annotation-item .text-xs{color:#a0aec0}body.modo-sepia .annotation-item .text-xs{color:#8c7b6a}.annotation-item p{font-size:.875rem;line-height:1.5;white-space:pre-wrap;word-break:break-word}
        
        /* CORREÇÃO DEFINITIVA: Responsividade via Media Query */
        @media (max-width: 991px) {
            body { flex-direction: column; }
            nav.menu-lateral {
                height: 56px;
                width: 100%;
                order: -1; /* Coloca o menu no topo */
                display: flex;
                align-items: center;
                padding: 0 10px;
            }
            nav.menu-lateral ul {
                position: fixed;
                left: 0;
                top: 0;
                width: 280px;
                height: 100vh;
                background-color: var(--menu-bg);
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
                padding: 5px 0 40px 1%;
                z-index: 1500;
            }
            nav.menu-lateral.expandir ul {
                transform: translateX(0);
            }
            #main-content {
                height: calc(100% - 56px);
                width: 100%;
                margin-left: 0; /* Remove margem lateral */
            }
            #right-page-wrapper {
                display: none !important;
            }
            .button-left, .button-right {
                position: absolute;
                bottom: 15px;
                font-size: 40px;
                align-self: initial;
            }
            .button-left { left: 10px; margin-right: 0; }
            .button-right { right: 10px; margin-left: 0; }
        }
    </style>
</head>
<body>
    <nav class="menu-lateral">
        <div class="btn-expandir"><i id="btn-exp" class="bi bi-list"></i></div>
        <ul>
            <li class="item-menu"><div id="zoom-in" class="itens" title="Aumentar Zoom"><span class="icon"><i class="bi bi-plus-lg"></i></span><span class="txt-link">Aumentar o zoom</span></div></li>
            <li class="item-menu"><div id="zoom-out" class="itens" title="Diminuir Zoom"><span class="icon"><i class="bi bi-dash-lg"></i></span><span class="txt-link">Diminuir o zoom</span></div></li>
            <li class="item-menu"><div id="theme-btn" class="itens" title="Mudar Modo de Leitura"><span id="theme-icon-container" class="icon"><i class="bi bi-brightness-high-fill"></i></span><span class="txt-link">Modo de leitura</span></div></li>
            <li class="item-menu"><div id="annotate-btn" class="itens" title="Adicionar Anotação Pessoal"><span class="icon"><i class="bi bi-pencil"></i></span><span class="txt-link">Anotação Pessoal</span></div></li>
            <li class="item-menu"><div id="view-annotations-btn" class="itens" title="Ver Anotações"><span class="icon"><i class="bi bi-journal-text"></i></span><span class="txt-link">Ver Anotações</span></div></li>
        </ul>
    </nav>
    <main id="main-content">
        <button class="button-left"><i class="bi bi-arrow-left-circle-fill"></i></button>
        <div class="flipbook-container">
            <div class="page-container">
                <div id="left-page-wrapper" class="page-wrapper"><canvas id="leftPageCanvas"></canvas></div>
                <div id="bookmark-icon-left" class="bookmark-icon left"><i class="bi bi-bookmark-fill"></i></div>
            </div>
            <div class="page-container">
                <div id="right-page-wrapper" class="page-wrapper"><canvas id="rightPageCanvas"></canvas></div>
                <div id="bookmark-icon-right" class="bookmark-icon right"><i class="bi bi-bookmark-fill"></i></div>
            </div>
        </div>
        <button class="button-right"><i class="bi bi-arrow-right-circle-fill"></i></button>
        <div id="page-indicator"></div>
    </main>
    <div id="note-modal" class="modal"><div class="modal-content"><h3 id="note-modal-title" class="modal-title">Adicionar Anotação Pessoal</h3><textarea id="note-input" class="modal-textarea" placeholder="Digite sua anotação pessoal aqui..."></textarea><div class="modal-actions"><button id="note-cancel" class="modal-btn-secondary">Cancelar</button><button id="note-save" class="modal-btn-primary">Salvar</button></div></div></div>
    <div id="annotation-action-modal" class="modal"><div class="modal-content"><button id="annotation-close" title="Fechar" class="close-modal-btn">&times;</button><h3 class="modal-title">Sua Anotação</h3><p class="modal-note-text"></p><div class="modal-actions space-between"><button id="annotation-edit" class="modal-btn-yellow">Editar</button><button id="annotation-delete" class="modal-btn-red">Excluir</button></div></div></div>
    <div id="alert-modal" class="modal"><div class="modal-content text-center"><h3 class="modal-title">Aviso</h3><p id="alert-message" class="modal-text"></p><button id="alert-ok" class="modal-btn-primary">OK</button></div></div>
    <div id="annotations-panel" class="annotations-panel-class"><div class="annotations-panel-header"><div class="header-top-row"><h3 class="annotations-panel-title">Anotações Pessoais</h3><button id="close-annotations-btn" title="Fechar" class="close-annotations-btn-class"><i class="bi bi-x-lg"></i></button></div><input type="search" id="annotation-search-input" placeholder="Pesquisar anotações..."></div><div id="annotations-list" class="annotations-list-class"></div></div>

    <script>
        // Setup de elementos
        const params = new URLSearchParams(window.location.search);
        const pdfFile = params.get("pdf");
        if (!pdfFile) { document.body.innerHTML = "<p>Arquivo PDF não especificado.</p>"; throw new Error("PDF não especificado"); }
        const pdfPath = `../livro/livros-pdf/${decodeURIComponent(pdfFile)}`;
        const storageKey = `pdfReader-${pdfFile}`;
        const elements = {mainContent:document.getElementById('main-content'),leftCanvas:document.getElementById('leftPageCanvas'),rightCanvas:document.getElementById('rightPageCanvas'),rightPageWrapper:document.getElementById('right-page-wrapper'),btnExp:document.querySelector('#btn-exp'),menuLateral:document.querySelector('.menu-lateral'),zoomInBtn:document.getElementById('zoom-in'),zoomOutBtn:document.getElementById('zoom-out'),themeBtn:document.getElementById('theme-btn'),themeIconContainer:document.getElementById('theme-icon-container'),annotateBtn:document.getElementById('annotate-btn'),viewAnnotationsBtn:document.getElementById('view-annotations-btn'),bookmarkIconLeft:document.getElementById('bookmark-icon-left'),bookmarkIconRight:document.getElementById('bookmark-icon-right'),noteModal:document.getElementById('note-modal'),noteModalTitle:document.getElementById('note-modal-title'),noteInput:document.getElementById('note-input'),noteSaveBtn:document.getElementById('note-save'),noteCancelBtn:document.getElementById('note-cancel'),annotationsPanel:document.getElementById('annotations-panel'),closeAnnotationsBtn:document.getElementById('close-annotations-btn'),annotationsList:document.getElementById('annotations-list'),annotationSearchInput:document.getElementById('annotation-search-input'),annotationActionModal:document.getElementById('annotation-action-modal'),annotationCloseBtn:document.getElementById('annotation-close'),annotationEditBtn:document.getElementById('annotation-edit'),annotationDeleteBtn:document.getElementById('annotation-delete'),alertModal:document.getElementById('alert-modal'),alertMessage:document.getElementById('alert-message'),alertOkBtn:document.getElementById('alert-ok'),pageIndicator:document.getElementById('page-indicator')};
        const leftCtx = elements.leftCanvas.getContext('2d');
        const rightCtx = elements.rightCanvas.getContext('2d');
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js';
        const state = {pdfDoc:null,currentPage:1,scale:0.8,MIN_SCALE:0.5,annotations:[],bookmarkedPages:new Set(),editingAnnotation:null,activeAnnotationId:null};

        // Função que lê o CSS para saber o estado atual do layout
        function isSinglePageView() {
            return window.getComputedStyle(elements.rightPageWrapper).display === 'none';
        }

        async function renderPage(num, canvas, ctx, customScale) {
            if (!state.pdfDoc || num < 1 || num > state.pdfDoc.numPages) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                canvas.style.width = '0px'; canvas.style.height = '0px';
                return;
            }
            const page = await state.pdfDoc.getPage(num);
            const scaleToUse = customScale || state.scale;
            const viewport = page.getViewport({ scale: scaleToUse });
            const outputScale = window.devicePixelRatio || 1;
            canvas.width = Math.floor(viewport.width * outputScale);
            canvas.height = Math.floor(viewport.height * outputScale);
            canvas.style.width = `${viewport.width}px`;
            canvas.style.height = `${viewport.height}px`;
            const transform = outputScale !== 1 ? [outputScale, 0, 0, outputScale, 0, 0] : null;
            await page.render({ canvasContext: ctx, viewport, transform }).promise;
        }

        async function renderBook() {
            if (!state.pdfDoc) return;
            if (isSinglePageView()) {
                await renderPage(state.currentPage, elements.leftCanvas, leftCtx, state.scale);
            } else {
                const pageNumL = state.currentPage;
                const pageNumR = state.currentPage + 1;
                if (pageNumR > state.pdfDoc.numPages) {
                    await renderPage(pageNumL, elements.leftCanvas, leftCtx, state.scale);
                    await renderPage(0, elements.rightCanvas, rightCtx);
                } else {
                    const pageL = await state.pdfDoc.getPage(pageNumL);
                    const pageR = await state.pdfDoc.getPage(pageNumR);
                    const vpL = pageL.getViewport({ scale: 1 });
                    const vpR = pageR.getViewport({ scale: 1 });
                    const maxH = Math.max(vpL.height, vpR.height);
                    await renderPage(pageNumL, elements.leftCanvas, leftCtx, state.scale * (maxH / vpL.height));
                    await renderPage(pageNumR, elements.rightCanvas, rightCtx, state.scale * (maxH / vpR.height));
                }
            }
            updateUI();
        }

        function updateUI() {
            const singlePage = isSinglePageView();
            const totalPages = state.pdfDoc.numPages;
            // Indicador de Página
            if (singlePage) {
                elements.pageIndicator.textContent = `Página ${state.currentPage} de ${totalPages}`;
            } else {
                const endPage = Math.min(state.currentPage + 1, totalPages);
                elements.pageIndicator.textContent = (state.currentPage === endPage) ? `Página ${state.currentPage} de ${totalPages}` : `Páginas ${state.currentPage}-${endPage} de ${totalPages}`;
            }
            // Botões de Navegação
            document.querySelector('.button-left').style.visibility = (state.currentPage > 1) ? 'visible' : 'hidden';
            const isLastPage = singlePage ? (state.currentPage >= totalPages) : (state.currentPage + 1 >= totalPages);
            document.querySelector('.button-right').style.visibility = isLastPage ? 'hidden' : 'visible';
            // Marcadores
            elements.bookmarkIconLeft.classList.toggle('bookmarked', state.bookmarkedPages.has(state.currentPage));
            if (!singlePage) {
                elements.bookmarkIconRight.classList.toggle('bookmarked', state.bookmarkedPages.has(state.currentPage + 1));
            }
        }
        
        function navigate(direction) {
            const step = isSinglePageView() ? 1 : 2;
            const newPage = state.currentPage + (direction * step);
            if (newPage >= 1 && newPage <= state.pdfDoc.numPages) {
                state.currentPage = newPage;
                renderBook();
            }
        }

        function changeZoom(delta) {
            let newScale = state.scale + delta;
            if (delta > 0 && elements.leftCanvas.style.height && parseFloat(elements.leftCanvas.style.height) > 0) {
                const canvasHeight = parseFloat(elements.leftCanvas.style.height);
                const pageHeight = canvasHeight / state.scale;
                const availableHeight = elements.mainContent.clientHeight - 40;
                if (pageHeight > 0) newScale = Math.min(newScale, availableHeight / pageHeight);
            }
            state.scale = Math.max(state.MIN_SCALE, newScale);
            renderBook();
        }

        pdfjsLib.getDocument(pdfPath).promise.then(pdfDoc_ => {
            state.pdfDoc = pdfDoc_;
            loadData();
            renderBook();
        });

        // Event Listeners
        document.querySelector('.button-left').addEventListener('click', () => navigate(-1));
        document.querySelector('.button-right').addEventListener('click', () => navigate(1));
        elements.zoomInBtn.addEventListener('click', () => changeZoom(0.1));
        elements.zoomOutBtn.addEventListener('click', () => changeZoom(-0.1));
        elements.btnExp.addEventListener('click', () => {
            elements.menuLateral.classList.toggle('expandir');
        });
        document.addEventListener('keydown', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (e.key === 'ArrowLeft') navigate(-1);
            else if (e.key === 'ArrowRight') navigate(1);
            else if (e.key === '+' || e.key === '=') { e.preventDefault(); changeZoom(0.1); }
            else if (e.key === '-' || e.key === '_') { e.preventDefault(); changeZoom(-0.1); }
        });
        window.addEventListener('resize', renderBook);

        // Funções de Anotações, Bookmarks, Temas, LocalStorage (Sem alterações, compactadas)
        function openModal(modal){modal.style.display='flex'}function closeModal(modal){modal.style.display='none'}function showAlert(message){elements.alertMessage.textContent=message;openModal(elements.alertModal)}elements.alertOkBtn.addEventListener('click',()=>closeModal(elements.alertModal));elements.annotateBtn.addEventListener('click',()=>{state.editingAnnotation=null;elements.noteInput.value='';elements.noteModalTitle.textContent="Adicionar Anotação Pessoal";openModal(elements.noteModal)});elements.noteSaveBtn.addEventListener('click',()=>{const noteText=elements.noteInput.value.trim();if(!noteText){showAlert("A anotação não pode estar vazia.");return}if(state.editingAnnotation){state.editingAnnotation.note=noteText}else{state.annotations.push({id:Date.now(),note:noteText,date:new Date()})}saveData();renderAnnotationsPanel();closeModal(elements.noteModal);state.editingAnnotation=null});elements.noteCancelBtn.addEventListener('click',()=>{closeModal(elements.noteModal);state.editingAnnotation=null});elements.viewAnnotationsBtn.addEventListener('click',()=>{renderAnnotationsPanel();elements.annotationsPanel.classList.add('open')});elements.closeAnnotationsBtn.addEventListener('click',()=>{elements.annotationsPanel.classList.remove('open')});elements.annotationSearchInput.addEventListener('input',e=>renderAnnotationsPanel(e.target.value));function renderAnnotationsPanel(searchTerm=''){elements.annotationsList.innerHTML='';const searchLower=searchTerm.toLowerCase();const filteredAnnotations=state.annotations.filter(annotation=>annotation.note.toLowerCase().includes(searchLower));filteredAnnotations.slice().reverse().forEach(annotation=>{const item=document.createElement('div');item.className='annotation-item';item.dataset.annotationId=annotation.id;const formattedDate=new Date(annotation.date).toLocaleString('pt-BR');item.innerHTML=`<div class="text-xs"><span>${formattedDate}</span></div><p>${annotation.note}</p>`;item.addEventListener('click',()=>{state.activeAnnotationId=annotation.id;elements.annotationActionModal.querySelector('.modal-note-text').textContent=annotation.note;openModal(elements.annotationActionModal)});elements.annotationsList.appendChild(item)})}elements.annotationCloseBtn.addEventListener('click',()=>closeModal(elements.annotationActionModal));elements.annotationEditBtn.addEventListener('click',()=>{const annotation=findAnnotationById(state.activeAnnotationId);if(!annotation)return;state.editingAnnotation=annotation;elements.noteModalTitle.textContent="Editar Anotação";elements.noteInput.value=annotation.note;closeModal(elements.annotationActionModal);openModal(elements.noteModal)});elements.annotationDeleteBtn.addEventListener('click',()=>{if(confirm("Tem certeza que deseja excluir esta anotação?")){state.annotations=state.annotations.filter(ann=>ann.id!==state.activeAnnotationId);saveData();renderAnnotationsPanel();closeModal(elements.annotationActionModal)}});function findAnnotationById(id){return state.annotations.find(ann=>ann.id===id)}function toggleBookmark(pageNum,iconElement){if(state.bookmarkedPages.has(pageNum)){state.bookmarkedPages.delete(pageNum)}else{state.bookmarkedPages.add(pageNum)}iconElement.classList.add('animate-pop');setTimeout(()=>iconElement.classList.remove('animate-pop'),300);updateUI();saveData()}elements.bookmarkIconLeft.addEventListener('click',()=>toggleBookmark(state.currentPage,elements.bookmarkIconLeft));elements.bookmarkIconRight.addEventListener('click',()=>{if(state.currentPage+1<=state.pdfDoc.numPages){toggleBookmark(state.currentPage+1,elements.bookmarkIconRight)}});const modos=["modo-claro","modo-noturno","modo-sepia"];let indiceModo=0;function aplicarModo(modo){document.body.className='';document.body.classList.add(modo);const icon=elements.themeIconContainer.querySelector('i');if(modo==="modo-claro")icon.className="bi bi-brightness-high-fill";else if(modo==="modo-noturno")icon.className="bi bi-moon-fill";else icon.className="bi bi-circle-square";localStorage.setItem("themeMode",modo)}elements.themeBtn.addEventListener("click",()=>{indiceModo=(indiceModo+1)%modos.length;aplicarModo(modos[indiceModo])});function saveData(){const data={annotations:state.annotations,bookmarkedPages:Array.from(state.bookmarkedPages)};localStorage.setItem(storageKey,JSON.stringify(data))}function loadData(){const savedData=localStorage.getItem(storageKey);if(savedData){const data=JSON.parse(savedData);state.annotations=data.annotations||[];state.bookmarkedPages=new Set(data.bookmarkedPages||[])}const modoSalvo=localStorage.getItem("themeMode")||"modo-claro";indiceModo=modos.indexOf(modoSalvo);aplicarModo(modoSalvo)}
    </script>
</body>
</html>